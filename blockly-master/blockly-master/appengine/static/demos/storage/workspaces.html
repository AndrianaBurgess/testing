<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Cloud Storage</title>
  <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase-auth.js"></script>
  <script src="./firebaseconfig.js"></script>
  <script src="keystorage.js"></script>
  <script src="auth.js"></script>
  <script src="../../blockly_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="./index.js" type="module"></script>
  <script src="./beaglebone.js"></script>
  <script src="../../msg/js/en.js"></script>


  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }

    h1 {
      font-weight: normal;
      font-size: 140%;
    }

    #sorry {
      padding: 1ex;
      background-color: #f9edbe;
      border: solid 1px #f0c36d;
    }
  </style>
</head>

<body>

  <p>
    <button id="newWorkspace">Create New Workspace</button>

  </p>

  <div id="workspaces"></div>

  <script>

    document.addEventListener("DOMContentLoaded",  () => {
      firebase.auth().onAuthStateChanged(function (user) {
        if(user){
          // localStorage.setItem('email',user.email);
          init();
        }else{
          console.log("Shitttyyy")
        }
        
      });

    });



    async function init(){
      console.log(localStorage.getItem("workspaceName"));

      document.getElementById("newWorkspace").onclick = function () {
        location.href = "index.html";
        localStorage.removeItem('workspaceName');
      };

      const workspaces = await KeyStorage.getAll();
        workspaces.forEach(element => {
          const workspace = document.createElement("A")
          workspace.onclick = function() {
            localStorage.setItem('workspaceName', element.name);
            console.log('Opened index.html for: ' + element.name + ' workspace');
          };
          workspace.href = "index.html" ;
          const name = document.createTextNode(element.name);
          workspace.appendChild(name);
          document.getElementById("workspaces").appendChild(workspace);
        });
    }


  </script>

</body>

</html>